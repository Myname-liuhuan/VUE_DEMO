# VUE_DEMO

vue项目，通过拉取其它github代码然后修改添加自己功能

## 权限校验流程

### 🔍 权限校验逻辑可视化

```
┌─────────────────────────────────────────────────────────────────────┐
│                        开始权限检查                                  │
└─────────────────────────────┬───────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────────┐
│                    检查路由是否有权限要求？                            │
└─────────────────────┬───────────────────┬───────────────────────────┘
                      │                   │
                      │ 无权限要求         │ 有权限要求
                      ▼                   ▼
            ┌──────────────────┐    ┌──────────────────────────────┐
            │     直接通过      │    │         继续检查              │
            └────────┬─────────┘    └──────────────┬─────────────────┘
                     │                              │
                     └──────────────┬───────────────┘
                                    ▼
                    ┌───────────────────────────────────────────────┐
                    │        角色权限检查 AND 权限路径检查             │
                    └─────┬─────────────────────┬───────────────────┘
                          │                     │
                          ▼                     ▼
                ┌─────────────────┐    ┌─────────────────┐
                │   角色权限检查    │    │   权限路径检查    │
                └─────┬─────┬───────┘    └─────┬─────┬───────┘
                      │     │                  │     │
                      ▼     ▼                  ▼     ▼
                ┌───┐   ┌───┐            ┌───┐   ┌───┐
                │无 │   │有 │            │无 │   │有 │
                │角 │   │角 │            │权 │   │权 │
                │色 │   │色 │            │限 │   │限 │
                │要 │   │要 │            │要 │   │要 │
                │求 │   │求 │            │求 │   │求 │
                └─┬─┘   └─┬─┘            └─┬─┘   └─┬─┘
                  │       │                │       │
                  ▼       ▼                ▼       ▼
              ┌───┐   ┌───┐            ┌───┐   ┌───┐
              │通 │   │用 │            │通 │   │路 │
              │过 │   │户 │            │过 │   │径 │
              │   │   │角 │            │   │   │匹 │
              │   │   │色 │            │   │   │配 │
              │   │   │包 │            │   │   │成 │
              │   │   │含 │            │   │   │功 │
              │   │   │至 │            │   │   │   │
              │   │   │少 │            │   │   │   │
              │   │   │一 │            │   │   │   │
              │   │   │个 │            │   │   │   │
              │   │   │所 │            │   │   │   │
              │   │   │需 │            │   │   │   │
              │   │   │角 │            │   │   │   │
              │   │   │色 │            │   │   │   │
              └─┬─┘   └─┬─┘            └─┬─┘   └─┬─┘
                │       │                │       │
                │       │是              │       │是
                │       ▼                │       ▼
                │   ┌───┐                │   ┌───┐
                │   │通 │                │   │通 │
                │   │过 │                │   │过 │
                │   └─┬─┘                │   └─┬─┘
                │     │                  │     │
                └─────┼──────────────────┼─────┘
                      │                  │
                      ▼                  ▼
                ┌─────────────────────────────────┐
                │           最终通过                │
                └─────────────────────────────────┘
```

### 📊 权限校验状态表

| 检查项目 | 状态 | 结果 | 说明 |
|---------|------|------|------|
| 路由权限要求 | ❌ 无要求 | ✅ 通过 | 所有用户可访问 |
| 路由权限要求 | ✅ 有要求 | ⏳ 继续检查 | 需要进一步验证 |
| 角色权限 | ❌ 无角色要求 | ✅ 通过 | 不限制角色 |
| 角色权限 | ✅ 有角色要求 | ⏳ 验证用户角色 | 用户需包含至少一个所需角色 |
| 权限路径 | ❌ 无权限要求 | ✅ 通过 | 不限制权限 |
| 权限路径 | ✅ 有权限要求 | ⏳ 验证路径匹配 | 需匹配路径或权限标识符 |

### 🎯 决策矩阵

| 场景 | 角色检查 | 权限检查 | 最终结果 |
|------|----------|----------|----------|
| 1 | 通过 | 通过 | ✅ 允许访问 |
| 2 | 通过 | 拒绝 | ❌ 拒绝访问 |
| 3 | 拒绝 | 通过 | ❌ 拒绝访问 |
| 4 | 拒绝 | 拒绝 | ❌ 拒绝访问 |
| 5 | 无要求 | 通过 | ✅ 允许访问 |
| 6 | 通过 | 无要求 | ✅ 允许访问 |
| 7 | 无要求 | 无要求 | ✅ 允许访问 |



## 权限校验详细说明

### 1. 整体逻辑结构
- **最终权限 = 角色权限检查 AND 权限路径检查**
- 必须同时满足角色和权限验证才能访问路由

### 2. 角色权限检查 (hasRolePermission)
```javascript
hasRolePermission = !route.meta?.roles OR route.meta.roles.some(role => roles.includes(role))
```
- **无角色要求**：如果路由没有设置 `meta.roles`，所有角色都可访问
- **有角色要求**：用户角色必须包含路由要求的至少一个角色（OR关系）

### 3. 权限路径检查 (hasAuthorityPermission)
```javascript
hasAuthorityPermission = 
  !permissions OR 
  permissions.length === 0 OR 
  permissions.some(permission => 路径匹配 OR 权限标识符匹配)
```

#### 路径匹配方式：
- 路由路径 == 权限路径
- 路由路径 以 权限路径 + '/' 开头
- 权限路径 == 路由路径

#### 权限标识符匹配方式：
- 路由有明确的 authority 要求，且与权限的 authority 完全匹配
- 根据路由路径推断权限，匹配权限标识符的模块部分

### 4. 特殊处理
- **无权限要求的路由**：直接通过
- **权限获取失败**：返回空数组，不会赋予默认权限

### 5. 安全改进
- ✅ 移除了 admin 角色的硬编码特权
- ✅ 所有用户统一使用相同的权限校验逻辑
- ✅ 权限控制完全依赖后端返回的角色和权限数据
- ✅ 提高了系统的安全性和一致性
